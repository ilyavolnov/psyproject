const initSqlJs = require('sql.js');
const fs = require('fs');
const path = require('path');

const dbPath = path.join(__dirname, 'database.sqlite');

function generateSlug(title) {
    const translitMap = {
        '–∞': 'a', '–±': 'b', '–≤': 'v', '–≥': 'g', '–¥': 'd', '–µ': 'e', '—ë': 'yo', '–∂': 'zh',
        '–∑': 'z', '–∏': 'i', '–π': 'y', '–∫': 'k', '–ª': 'l', '–º': 'm', '–Ω': 'n', '–æ': 'o',
        '–ø': 'p', '—Ä': 'r', '—Å': 's', '—Ç': 't', '—É': 'u', '—Ñ': 'f', '—Ö': 'h', '—Ü': 'ts',
        '—á': 'ch', '—à': 'sh', '—â': 'sch', '—ä': '', '—ã': 'y', '—å': '', '—ç': 'e', '—é': 'yu', '—è': 'ya'
    };
    
    return title
        .toLowerCase()
        .split('')
        .map(char => translitMap[char] || char)
        .join('')
        .replace(/[^a-z0-9]+/g, '-')
        .replace(/^-+|-+$/g, '');
}

async function addWebinar() {
    try {
        const SQL = await initSqlJs();
        const buffer = fs.readFileSync(dbPath);
        const db = new SQL.Database(buffer);
        
        const title = '–ö–∞–∫ –Ω–µ –Ω–∞–±—Ä–∞—Ç—å –ª–∏—à–Ω–∏—Ö –∫–∏–ª–æ–≥—Ä–∞–º–º –æ—Å–µ–Ω—å—é-–∑–∏–º–æ–π? 5 —Ä–∞–±–æ—á–∏—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –æ—Ç –ø—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–µ–≤—Ç–∞';
        const slug = generateSlug(title);
        
        const pageBlocks = [
            {
                type: 'hero',
                data: {
                    image: 'images/webinars/autumn-weight.jpg',
                    title: title,
                    price: 2500,
                    startDate: '–í –¥–æ—Å—Ç—É–ø–µ',
                    paymentInstructions: '–ù–∞ –Ω–æ–º–µ—Ä –≤ WhatsApp 8 921 188 07 55 –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–∫—Ä–∏–Ω –æ–ø–ª–∞—Ç—ã (–∏–ª–∏ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π —á–µ–∫). –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã —è —Å–≤—è–∂—É—Å—å —Å –í–∞–º–∏ –≤ WhatsApp.'
                }
            },
            {
                type: 'description',
                data: {
                    image: '',
                    title: '–ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª - –∫ –ª–µ—Ç—É –Ω–µ–º–Ω–æ–≥–æ —Å–±—Ä–æ—Å–∏—Ç—å, –∞ –æ—Å–µ–Ω—å—é –Ω–∞–±—Ä–∞—Ç—å –µ—â—ë –±–æ–ª—å—à–µ, —á–µ–º –±—ã–ª–æ',
                    subtitle: '–ó–Ω–∞–∫–æ–º–æ? –ß—É–≤—Å—Ç–≤–æ –≤–∏–Ω—ã –∑–∞ –ø–µ—Ä–µ–µ–¥–∞–Ω–∏–µ, –ª–µ–Ω—å –∏ —Å–Ω–∏–∂–µ–Ω–∏–µ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏',
                    contentType: '–ó–∞–ø–∏—Å—å + –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è'
                }
            },
            {
                type: 'program',
                data: {
                    title: '–ó–∞ 50 –º–∏–Ω—É—Ç –≤—ã —É–∑–Ω–∞–µ—Ç–µ',
                    items: [
                        '–õ–µ–≥–∫–∏–µ —Å–ø–æ—Å–æ–±—ã –ø–æ–º–æ—á—å —Å–µ–±–µ –Ω–µ –ø–µ—Ä–µ–µ–¥–∞—Ç—å, –∫–æ–≥–¥–∞ –∑–∞ –æ–∫–Ω–æ–º —Å–µ—Ä–æ –∏ —Ö–æ–ª–æ–¥–Ω–æ',
                        '–ö–∞–∫ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–µ–¥–∞–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é –ø–æ–Ω–∏–º–∞–Ω–∏—è –∏ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏ –¥–µ—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã—Ö –ø–∏—â–µ–≤—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤',
                        '5 —Ä–∞–±–æ—á–∏—Ö –∏ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π, —á—Ç–æ–± —Å–¥–µ–ª–∞—Ç—å —Å–≤–æ–∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å –µ–¥–æ–π –±–æ–ª–µ–µ –∑–¥–æ—Ä–æ–≤—ã–º–∏'
                    ]
                }
            },
            {
                type: 'author',
                data: {
                    photo: 'images/specialists/margarita.jpg',
                    name: '–ú–∞—Ä–≥–∞—Ä–∏—Ç–∞ –†—É–º—è–Ω—Ü–µ–≤–∞',
                    credentials: [
                        '–í—Ä–∞—á-–ø—Å–∏—Ö–∏–∞—Ç—Ä, –ø—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–µ–≤—Ç, —Å–µ–∫—Å–æ–ª–æ–≥ (—Å—Ç–∞–∂ —Å 2009 –≥., –æ–ø—ã—Ç —Ä–∞–±–æ—Ç—ã –≤ –ø—Å–∏—Ö–∏–∞—Ç—Ä–∏—á–µ—Å–∫–æ–π –±–æ–ª—å–Ω–∏—Ü–µ –∏–º. –ü. –ü. –ö–∞—â–µ–Ω–∫–æ –±–æ–ª–µ–µ 10 –ª–µ—Ç)',
                        'EMDR-—Ç–µ—Ä–∞–ø–µ–≤—Ç —Å –∞–∫–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏–µ–π –≤ –ï–≤—Ä–æ–ø–µ',
                        '–°–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –°—É–ø–µ—Ä–≤–∏–∑–æ—Ä',
                        '–ì—Ä—É–ø–ø–æ–≤–æ–π –ø—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–µ–≤—Ç',
                        '–°–µ–º–µ–π–Ω—ã–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç',
                        'IFS-—Ç–µ—Ä–∞–ø–µ–≤—Ç',
                        '–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –ò–Ω—Å—Ç–∏—Ç—É—Ç–∞ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –ü—Å–∏—Ö–æ–ª–æ–≥–∏–∏ –ò–º–∞—Ç–æ–Ω, –¶–µ–Ω—Ç—Ä–∞ EMDR/–î–ü–î–ì –≤ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–µ',
                        '–≠–∫—Å–ø–µ—Ä—Ç —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω–æ–≥–æ –¢–í-–∫–∞–Ω–∞–ª–∞ ¬´–ü—è—Ç–Ω–∏—Ü–∞¬ª',
                        '–°–æ–∑–¥–∞—Ç–µ–ª—å –æ–±—É—á–∞—é—â–∏—Ö –∫—É—Ä—Å–æ–≤ –¥–ª—è –ø—Å–∏—Ö–æ–ª–æ–≥–æ–≤ –∏ –∞–≤—Ç–æ—Ä –ø—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–∏—Ö –æ–Ω–ª–∞–π–Ω-–ø—Ä–æ–µ–∫—Ç–æ–≤ (–∑–∞–ø—É—Å–∫–∏ —Å 2018 –≥.)'
                    ]
                }
            }
        ];
        
        const query = `
            INSERT INTO courses (
                title, subtitle, description, price, status, image,
                release_date, access_duration, feedback_duration,
                has_certificate, whatsapp_number, topics, bonuses,
                materials, author_name, author_description, page_blocks, type, slug
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
        `;
        
        db.run(query, [
            title,
            '5 —Ä–∞–±–æ—á–∏—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –æ—Ç –ø—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–µ–≤—Ç–∞',
            '–£–∑–Ω–∞–π—Ç–µ, –∫–∞–∫ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–µ–¥–∞–Ω–∏–µ –∏ –Ω–µ –Ω–∞–±—Ä–∞—Ç—å –ª–∏—à–Ω–∏–π –≤–µ—Å –æ—Å–µ–Ω—å—é –∏ –∑–∏–º–æ–π',
            2500,
            'available',
            'images/webinars/autumn-weight.jpg',
            '–í –¥–æ—Å—Ç—É–ø–µ',
            '–ë–µ—Å—Å—Ä–æ—á–Ω—ã–π –¥–æ—Å—Ç—É–ø',
            null,
            0,
            '89211880755',
            '[]',
            null,
            null,
            '–ú–∞—Ä–≥–∞—Ä–∏—Ç–∞ –†—É–º—è–Ω—Ü–µ–≤–∞',
            '–í—Ä–∞—á-–ø—Å–∏—Ö–∏–∞—Ç—Ä, –ø—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–µ–≤—Ç, —Å–µ–∫—Å–æ–ª–æ–≥',
            JSON.stringify(pageBlocks),
            'webinar',
            slug
        ]);
        
        // Save database
        const data = db.export();
        fs.writeFileSync(dbPath, data);
        db.close();
        
        console.log('‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π –≤–µ–±–∏–Ω–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω!');
        console.log('üìù –ù–∞–∑–≤–∞–Ω–∏–µ:', title);
        console.log('üîó Slug:', slug);
        console.log('üí∞ –¶–µ–Ω–∞: 2500 ‚ÇΩ');
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞:', error);
    }
}

addWebinar();
