const initSqlJs = require('sql.js');
const fs = require('fs');
const path = require('path');

const dbPath = path.join(__dirname, 'database.sqlite');

function generateSlug(title) {
    const translitMap = {
        '–∞': 'a', '–±': 'b', '–≤': 'v', '–≥': 'g', '–¥': 'd', '–µ': 'e', '—ë': 'yo', '–∂': 'zh',
        '–∑': 'z', '–∏': 'i', '–π': 'y', '–∫': 'k', '–ª': 'l', '–º': 'm', '–Ω': 'n', '–æ': 'o',
        '–ø': 'p', '—Ä': 'r', '—Å': 's', '—Ç': 't', '—É': 'u', '—Ñ': 'f', '—Ö': 'h', '—Ü': 'ts',
        '—á': 'ch', '—à': 'sh', '—â': 'sch', '—ä': '', '—ã': 'y', '—å': '', '—ç': 'e', '—é': 'yu', '—è': 'ya'
    };

    return title
        .toLowerCase()
        .split('')
        .map(char => translitMap[char] || char)
        .join('')
        .replace(/[^a-z0-9]+/g, '-')
        .replace(/^-+|-+$/g, '');
}

async function addWebinar() {
    try {
        const SQL = await initSqlJs();
        const buffer = fs.readFileSync(dbPath);
        const db = new SQL.Database(buffer);

        const title = '–ò–Ω—Ç–µ–Ω—Å–∏–≤ ¬´5 —Ç–µ—Ö–Ω–∏–∫ —Ö–æ—Ä–æ—à–µ–π –ª—é–±–æ–≤–Ω–∏—Ü—ã¬ª';
        const slug = generateSlug(title);

        const pageBlocks = [
            {
                type: 'hero',
                data: {
                    image: 'images/webinars/lover-techniques.jpg',
                    title: title,
                    price: 1900,
                    startDate: '–í –¥–æ—Å—Ç—É–ø–µ',
                    paymentInstructions: '–ù–∞ –Ω–æ–º–µ—Ä –≤ WhatsApp 8 921 188 07 55 –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–∫—Ä–∏–Ω –æ–ø–ª–∞—Ç—ã (–∏–ª–∏ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π —á–µ–∫). –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã —è —Å–≤—è–∂—É—Å—å —Å –í–∞–º–∏ –≤ What\'sApp.'
                }
            },
            {
                type: 'description',
                data: {
                    image: '',
                    title: '–í 2018-2019–ì–ì –≠–¢–û –ë–´–õ –°–ê–ú–´–ô –ü–†–û–°–ú–ê–¢–†–ò–í–ê–ï–ú–´–ô –í–ï–ë–ò–ù–ê–†',
                    subtitle: '–Ø –µ–≥–æ –æ–±–Ω–æ–≤–∏–ª–∞ –∏ –¥–æ–±–∞–≤–∏–ª–∞ –æ–≥–Ω—èüî•',
                    contentType: '–ü—Ä—è–º—ã–µ –∏ –ª–µ–≥–∫–æ —Ä–µ–∞–ª–∏–∑—É–µ–º—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏'
                }
            },
            {
                type: 'program',
                data: {
                    title: '–ü—Ä–æ–≥—Ä–∞–º–º–∞ –≤–µ–±–∏–Ω–∞—Ä–∞',
                    items: [
                        '–¢–µ—Ö–Ω–∏–∫–∏ –∏–∑ —Å–µ–∫—Å-—Ç–µ—Ä–∞–ø–∏–∏ –Ω–∞ –ø–∞–ª—å—Ü–∞—Ö üññ',
                        '–î–ª—è —è—Ä–∫–∏—Ö –æ—â—É—â–µ–Ω–∏–π –∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–≥–æ –ü–ê–†–¢–ù–Å–†—Å–∫–æ–≥–æ —Å–µ–∫—Å–∞',
                        '–î–æ—Å—Ç—É–ø –∫ –≤–∏–¥–µ–æ-–º–∞—Ç–µ—Ä–∏–∞–ª—É 3 –º–µ—Å—è—Ü–∞'
                    ]
                }
            },
            {
                type: 'author',
                data: {
                    photo: 'images/specialists/margarita.jpg',
                    name: '–ú–∞—Ä–≥–∞—Ä–∏—Ç–∞ –†—É–º—è–Ω—Ü–µ–≤–∞',
                    credentials: [
                        '–í—Ä–∞—á-–ø—Å–∏—Ö–∏–∞—Ç—Ä, –ø—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–µ–≤—Ç, —Å–µ–∫—Å–æ–ª–æ–≥ (—Å—Ç–∞–∂ —Å 2009 –≥., –æ–ø—ã—Ç —Ä–∞–±–æ—Ç—ã –≤ –ø—Å–∏—Ö–∏–∞—Ç—Ä–∏—á–µ—Å–∫–æ–π –±–æ–ª—å–Ω–∏—Ü–µ –∏–º. –ü. –ü. –ö–∞—â–µ–Ω–∫–æ –±–æ–ª–µ–µ 10 –ª–µ—Ç)',
                        'EMDR-—Ç–µ—Ä–∞–ø–µ–≤—Ç —Å –∞–∫–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏–µ–π –≤ –ï–≤—Ä–æ–ø–µ',
                        '–°–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –°—É–ø–µ—Ä–≤–∏–∑–æ—Ä',
                        '–ì—Ä—É–ø–ø–æ–≤–æ–π –ø—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–µ–≤—Ç',
                        '–°–µ–º–µ–π–Ω—ã–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç',
                        'IFS-—Ç–µ—Ä–∞–ø–µ–≤—Ç',
                        '–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –ò–Ω—Å—Ç–∏—Ç—É—Ç–∞ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –ü—Å–∏—Ö–æ–ª–æ–≥–∏–∏ –ò–º–∞—Ç–æ–Ω, –¶–µ–Ω—Ç—Ä–∞ EMDR/–î–ü–î–ì –≤ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–µ',
                        '–≠–∫—Å–ø–µ—Ä—Ç —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω–æ–≥–æ –¢–í-–∫–∞–Ω–∞–ª–∞ ¬´–ü—è—Ç–Ω–∏—Ü–∞¬ª',
                        '–°–æ–∑–¥–∞—Ç–µ–ª—å –æ–±—É—á–∞—é—â–∏—Ö –∫—É—Ä—Å–æ–≤ –¥–ª—è –ø—Å–∏—Ö–æ–ª–æ–≥–æ–≤ –∏ –∞–≤—Ç–æ—Ä –ø—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–∏—Ö –æ–Ω–ª–∞–π–Ω-–ø—Ä–æ–µ–∫—Ç–æ–≤ (–∑–∞–ø—É—Å–∫–∏ —Å 2018 –≥.)'
                    ]
                }
            }
        ];

        const query = `
            INSERT INTO courses (
                title, subtitle, description, price, status, image,
                release_date, access_duration, feedback_duration,
                has_certificate, whatsapp_number, topics,
                materials, author_name, author_description, page_blocks, type, slug
            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
        `;

        db.run(query, [
            title,
            '5 —Ç–µ—Ö–Ω–∏–∫ —Ö–æ—Ä–æ—à–µ–π –ª—é–±–æ–≤–Ω–∏—Ü—ã',
            '–í 2018-2019–ì–ì –≠–¢–û –ë–´–õ –°–ê–ú–´–ô –ü–†–û–°–ú–ê–¢–†–ò–í–ê–ï–ú–´–ô –í–ï–ë–ò–ù–ê–†. –Ø –µ–≥–æ –æ–±–Ω–æ–≤–∏–ª–∞ –∏ –¥–æ–±–∞–≤–∏–ª–∞ –æ–≥–Ω—èüî•. –ü—Ä—è–º—ã–µ –∏ –ª–µ–≥–∫–æ —Ä–µ–∞–ª–∏–∑—É–µ–º—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏. –¢–µ—Ö–Ω–∏–∫–∏ –∏–∑ —Å–µ–∫—Å-—Ç–µ—Ä–∞–ø–∏–∏ –Ω–∞ –ø–∞–ª—å—Ü–∞—Ö üññ. –î–ª—è —è—Ä–∫–∏—Ö –æ—â—É—â–µ–Ω–∏–π –∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–≥–æ –ü–ê–†–¢–ù–Å–†—Å–∫–æ–≥–æ —Å–µ–∫—Å–∞. –î–æ—Å—Ç—É–ø –∫ –≤–∏–¥–µ–æ-–º–∞—Ç–µ—Ä–∏–∞–ª—É 3 –º–µ—Å—è—Ü–∞',
            1900,
            'available',
            'images/webinars/lover-techniques.jpg',
            '–í –¥–æ—Å—Ç—É–ø–µ',
            '3 –º–µ—Å—è—Ü–∞',
            null,
            0,
            '89211880755',
            JSON.stringify([
                '–í 2018-2019–ì–ì –≠–¢–û –ë–´–õ –°–ê–ú–´–ô –ü–†–û–°–ú–ê–¢–†–ò–í–ê–ï–ú–´–ô –í–ï–ë–ò–ù–ê–†',
                '–Ø –µ–≥–æ –æ–±–Ω–æ–≤–∏–ª–∞ –∏ –¥–æ–±–∞–≤–∏–ª–∞ –æ–≥–Ω—èüî•',
                '–ü—Ä—è–º—ã–µ –∏ –ª–µ–≥–∫–æ —Ä–µ–∞–ª–∏–∑—É–µ–º—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏',
                '–¢–µ—Ö–Ω–∏–∫–∏ –∏–∑ —Å–µ–∫—Å-—Ç–µ—Ä–∞–ø–∏–∏ –Ω–∞ –ø–∞–ª—å—Ü–∞—Ö üññ',
                '–î–ª—è —è—Ä–∫–∏—Ö –æ—â—É—â–µ–Ω–∏–π –∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–≥–æ –ü–ê–†–¢–ù–Å–†—Å–∫–æ–≥–æ —Å–µ–∫—Å–∞',
                '–î–æ—Å—Ç—É–ø –∫ –≤–∏–¥–µ–æ-–º–∞—Ç–µ—Ä–∏–∞–ª—É 3 –º–µ—Å—è—Ü–∞'
            ]),
            '–í–∏–¥–µ–æ-–º–∞—Ç–µ—Ä–∏–∞–ª—ã',
            '–ú–∞—Ä–≥–∞—Ä–∏—Ç–∞ –†—É–º—è–Ω—Ü–µ–≤–∞',
            '–í—Ä–∞—á-–ø—Å–∏—Ö–∏–∞—Ç—Ä, –ø—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–µ–≤—Ç, —Å–µ–∫—Å–æ–ª–æ–≥',
            JSON.stringify(pageBlocks),
            'webinar',
            slug
        ]);

        // Save database
        const data = db.export();
        fs.writeFileSync(dbPath, data);
        db.close();

        console.log('‚úÖ –í–µ–±–∏–Ω–∞—Ä ¬´–ò–Ω—Ç–µ–Ω—Å–∏–≤ ¬´5 —Ç–µ—Ö–Ω–∏–∫ —Ö–æ—Ä–æ—à–µ–π –ª—é–±–æ–≤–Ω–∏—Ü—ã¬ª¬ª –¥–æ–±–∞–≤–ª–µ–Ω!');
        console.log('üìù –ù–∞–∑–≤–∞–Ω–∏–µ:', title);
        console.log('üîó Slug:', slug);
        console.log('üí∞ –¶–µ–Ω–∞: 1900 ‚ÇΩ');
        console.log('üì± WhatsApp: 89211880755');

    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞:', error);
    }
}

addWebinar();
